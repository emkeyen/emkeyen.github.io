<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="Mykhail Stieblov Blog Posts">
    <title>Converting Postman collections with env support to JMeter</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
    <link rel="stylesheet" type="text/css" href="http://127.0.0.1:8000/theme/css/main.css" />
    <link rel="stylesheet" type="text/css" href="http://127.0.0.1:8000/theme/css/pygment.css" />
    <link rel="shortcut icon" href="http://127.0.0.1:8000/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="http://127.0.0.1:8000/theme/css/stork.css">
    <link rel="stylesheet" media="screen and (prefers-color-scheme: dark)"
        href="http://127.0.0.1:8000/theme/css/stork-dark.css">
    <link
        href="http://127.0.0.1:8000/feeds/all.atom.xml"
        type="application/atom+xml" rel="alternate" title="Mykhail Stieblov Atom Feed" />
<meta name="description" content="Converter written in Python 3 for Postman API collections & env into JMeter (jmx) test plans." />
</head>

<body class="min-h-screen flex flex-col max-w-7xl lg:max-w-none text-zinc-800 bg-neutral-100 
    dark:bg-neutral-900 dark:text-zinc-300 container mx-auto justify-center md:px-3 ">
    <script>
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia(
                '(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
    <nav class="sm:flex sm:justify-between xl:ml-32 pl-4 items-center">
        <div class="flex pt-4">
            <h1 class="font-semibold text-2xl"><a href="http://127.0.0.1:8000/">Mykhail Stieblov</a></h1>
            <button id="theme-toggle" type="button" aria-label="Light|Dark"
                class="text-zinc-700 dark:text-zinc-400 rounded-full focus:outline-none text-sm ml-2 p-1">
                <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                </svg>
                <svg id="theme-toggle-light-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                        fill-rule="evenodd" clip-rule="evenodd"></path>
                </svg>
            </button>
        </div>
        <ul class="flex flex-wrap lg:mr-24 md:pt-0">
            <li class="mr-4 pt-6"><a                     href="http://127.0.0.1:8000/categories.html">Categories</a></li>
            <li class="mr-4 pt-6"><a  href="http://127.0.0.1:8000/tags.html">Tags</a></li>
            <li class="mr-4 pt-6"><a  href="http://127.0.0.1:8000/search.html">Search</a></li>
            <li class="mr-4 pt-6"><a  href="http://127.0.0.1:8000/archives.html">Archive</a></li>
        </ul>
    </nav>
    <div class="flex-grow md:max-w-screen-md md:mx-auto md:w-3/4 px-4">
        <nav class="text-zinc-800 dark:text-zinc-300 mt-12 pb-2 md:mt-16" aria-label="Breadcrumb">
            <ul class="p-0 inline-flex items-center">
                <li class="flex items-center">
                    <a href="http://127.0.0.1:8000/" class="text-zinc-800 dark:text-zinc-300 inline-flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z">
                            </path>
                        </svg>
                        Home
                    </a>
                    <svg class="fill-current w-3 h-3 mr-2 ml-1" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 320 512">
                        <path
                            d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z" />
                    </svg>
                </li>
                <li class="flex items-center">
                    <a href="http://127.0.0.1:8000/categories.html">Categories</a>
                    <svg class="fill-current w-3 h-3 mr-2 ml-1" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 320 512">
                        <path
                            d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z" />
                    </svg>
                </li>
                <li class="flex items-center">
                    <a href="http://127.0.0.1:8000/category/testing.html">Testing</a>
                    <svg class="fill-current w-3 h-3 mr-2 ml-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
                        <path
                            d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z" />
                    </svg>
                </li>
            </ul>
        </nav>

<main>
  <header>
    <h1 class="font-semibold text-3xl my-2">Converting Postman collections with env support to JMeter</h1>
    <footer class="flex text-sm text-zinc-800 dark:text-zinc-400">
      <div class="flex text-xs text-zinc-800 dark:text-zinc-400">
        <time>czerwca 06, 2025</time>
        <div>
          <span>&nbsp;·&nbsp;21 min read</span>
        </div>
        <div>
          <span>&nbsp;·&nbsp;emkeyen</span>
        </div>
      </div>
    </footer>
  </header>
  <details class="flex flex-col my-6 p-4 bg-zinc-200 dark:bg-zinc-800 rounded-lg">
    <summary class="text-lg font-bold">Table of contents</summary>
    <div class="mx-4 px-4 underline">
      <div id="toc"><ul><li><a class="toc-href" href="#functionality" title="Functionality">Functionality</a></li><li><a class="toc-href" href="#usage" title="Usage">Usage</a></li><li><a class="toc-href" href="#notes" title="Notes">Notes</a></li></ul></div>
    </div>
  </details>
  <div class="max-w-7xl container mx-auto my-8 text-zinc-800 dark:text-zinc-300  
              prose lg:max-w-none prose-headings:text-zinc-800 prose-headings:dark:text-zinc-300 
              prose-h1:text-3xl lg:prose-h1:text-3xl prose-headings:font-semibold 
              prose-pre:bg-zinc-200 prose-pre:text-zinc-800
              dark:prose-pre:bg-zinc-800 dark:prose-pre:text-zinc-200
              prose-blockquote:text-zinc-800
              dark:prose-blockquote:text-zinc-200
              prose-a:text-slate-600 prose-a:font-normal
              dark:prose-a:text-slate-400
              dark:prose-strong:text-zinc-200 
              dark:prose-code:text-zinc-200
              dark:prose-code:bg-zinc-800
              prose-code:bg-zinc-200
              prose-code:font-light
              prose-img:rounded-md
              sm:text-left md:text-justify
              ">
    <p>If you've ever had to migrate Postman API tests into JMeter for load testing, you know the drill: either you manually recreate everything (pain), or you find some hacky tool that half-works. So I wrote a script in Python to make this a bit less annoying.</p>
<p>The source code is available on GitHub:
<a href="https://github.com/emkeyen/postman-to-jmx" target="_blank">https://github.com/emkeyen/postman-to-jmx</a></p>
<h3 id="functionality">Functionality</h3>
<ul>
<li>Converts a Postman collection JSON into a JMeter <code>jmx</code> test plan.</li>
<li>Adds support for raw body, form-urlencoded, headers, query params.</li>
<li>Pulls in both collection-level vars and optional env files as JMeter <em>User Defined Variables</em>.</li>
<li>Handles folders, nested requests, and basic structure in a way JMeter can actually use.</li>
</ul>
<h3 id="usage">Usage</h3>
<p>Just save the script as <code>postman2jmx.py</code>, make it executable, and run it like this:</p>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>postman2jmx.py
./postman2jmx.py<span class="w"> </span>my_collection.json<span class="w"> </span>output.jmx<span class="w"> </span>-e<span class="w"> </span>my_env.json
</code></pre></div>
<p>The <code>-e</code> flag is optional. If you pass in an environment JSON exported from Postman, it&rsquo;ll include those values in the test plan.</p>
<h3 id="notes">Notes</h3>
<ul>
<li>A single-thread JMeter test plan (you can tweak that later).</li>
<li>Every request in Postman becomes a corresponding <code>HTTPSamplerProxy</code>.</li>
<li>Headers and body content (raw or form) are preserved.</li>
<li>Query params are parsed and added as proper JMeter args.</li>
<li>Vars show up in the Test Plan as global UDV blocks.</li>
<li>Variables from your Postman collection and environment will appear as "User Defined Variables" in JMeter. Remember that in JMeter, you reference these variables using ${variable_name}.</li>
<li>The script handles raw JSON and x-www-form-urlencoded bodies. Other complex body types (like formdata with file uploads) might need manual adjustment in JMeter after conversion.</li>
<li>Any JS code you have in Postman's pre-request or test scripts won't be converted. You'll need to re-implement that logic in JMeter using JSR223 samplers or other JMeter elements.</li>
</ul>
<p>Mostly for folks who already use Postman heavily for API development but need to load test without rebuilding everything from scratch in JMeter. You still might need to tweak the resulting <code>jmx</code> for more advanced stuff (think auth flows, assertions, etc.), but it saves a bunch of boilerplate work.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">from</span> <span class="nn">xml.dom</span> <span class="kn">import</span> <span class="n">minidom</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">parse_qs</span>

<span class="k">def</span> <span class="nf">convert_postman_to_jmx</span><span class="p">(</span><span class="n">postman_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">environment_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Converts a Postman collection JSON file to a JMeter JMX file.</span>

<span class="sd">    Args:</span>
<span class="sd">        postman_file (str): path to the Postman collection JSON file.</span>
<span class="sd">        output_file (str): path where the JMeter JMX file will be saved.</span>
<span class="sd">        environment_file (str, optional): path to the Postman env JSON file.</span>
<span class="sd">                                        if provided, env vars will be added.</span>
<span class="sd">    """</span>
    <span class="c1"># load Postman collection</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">postman_file</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># load Postman env if provided</span>
    <span class="n">environment_vars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">environment_file</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">environment_file</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_env</span><span class="p">:</span>
                <span class="n">environment_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f_env</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">'values'</span> <span class="ow">in</span> <span class="n">environment_data</span><span class="p">:</span>
                    <span class="c1"># filter for enabled vars from env</span>
                    <span class="n">environment_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">environment_data</span><span class="p">[</span><span class="s1">'values'</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'enabled'</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Warning: Environment file '</span><span class="si">{</span><span class="n">environment_file</span><span class="si">}</span><span class="s2">' not found. Skipping environment variables."</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Warning: Could not parse environment file '</span><span class="si">{</span><span class="n">environment_file</span><span class="si">}</span><span class="s2">'. Skipping environment variables."</span><span class="p">)</span>


    <span class="c1"># create JMX root structure</span>
    <span class="n">jmeter_test_plan</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">'jmeterTestPlan'</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">"1.2"</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="s2">"5.0"</span><span class="p">,</span> <span class="n">jmeter</span><span class="o">=</span><span class="s2">"5.2.1"</span><span class="p">)</span>
    <span class="n">hash_tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">jmeter_test_plan</span><span class="p">,</span> <span class="s1">'hashTree'</span><span class="p">)</span>

    <span class="c1"># create test plan</span>
    <span class="n">test_plan</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">hash_tree</span><span class="p">,</span> <span class="s1">'TestPlan'</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'TestPlanGui'</span><span class="p">,</span>
        <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'TestPlan'</span><span class="p">,</span>
        <span class="s1">'testname'</span><span class="p">:</span> <span class="s1">'Postman Collection Import'</span><span class="p">,</span>
        <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
    <span class="p">})</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">test_plan</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"TestPlan.functional_mode"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'false'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">test_plan</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"TestPlan.comments"</span><span class="p">)</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">test_plan</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"TestPlan.serialize_threadgroups"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'false'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">test_plan</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"TestPlan.user_define_classpath"</span><span class="p">)</span>

    <span class="c1"># add default user defined variables to the test plan (can be empty)</span>
    <span class="n">element_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">test_plan</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'TestPlan.user_defined_variables'</span><span class="p">,</span>
        <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'Arguments'</span>
    <span class="p">})</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'collectionProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Arguments.arguments"</span><span class="p">)</span>

    <span class="n">hash_tree2</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">hash_tree</span><span class="p">,</span> <span class="s1">'hashTree'</span><span class="p">)</span>

    <span class="c1"># create thread group</span>
    <span class="n">thread_group</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">hash_tree2</span><span class="p">,</span> <span class="s1">'ThreadGroup'</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'ThreadGroupGui'</span><span class="p">,</span>
        <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'ThreadGroup'</span><span class="p">,</span>
        <span class="s1">'testname'</span><span class="p">:</span> <span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'info'</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'Postman Requests'</span><span class="p">),</span>
        <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
    <span class="p">})</span>

    <span class="n">element_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">thread_group</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'ThreadGroup.main_controller'</span><span class="p">,</span>
        <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'LoopController'</span><span class="p">,</span>
        <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'LoopControlPanel'</span><span class="p">,</span>
        <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'LoopController'</span><span class="p">,</span>
        <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
    <span class="p">})</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"LoopController.continue_forever"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'false'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"LoopController.loops"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'1'</span>

    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">thread_group</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"ThreadGroup.num_threads"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'1'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">thread_group</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"ThreadGroup.ramp_time"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'1'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">thread_group</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"ThreadGroup.scheduler"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'false'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">thread_group</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"ThreadGroup.duration"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'0'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">thread_group</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"ThreadGroup.delay"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'0'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">thread_group</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"ThreadGroup.on_sample_error"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'continue'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">thread_group</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"ThreadGroup.same_user_on_next_iteration"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'true'</span>

    <span class="n">hash_tree3</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">hash_tree2</span><span class="p">,</span> <span class="s1">'hashTree'</span><span class="p">)</span>

    <span class="c1"># process collection vars</span>
    <span class="k">if</span> <span class="s1">'variable'</span> <span class="ow">in</span> <span class="n">collection</span><span class="p">:</span>
        <span class="n">add_user_defined_variables</span><span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="s1">'variable'</span><span class="p">],</span> <span class="n">hash_tree3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Collection Variables"</span><span class="p">)</span>

    <span class="c1"># process env vars</span>
    <span class="k">if</span> <span class="n">environment_vars</span><span class="p">:</span>
        <span class="n">add_user_defined_variables</span><span class="p">(</span><span class="n">environment_vars</span><span class="p">,</span> <span class="n">hash_tree3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Environment Variables"</span><span class="p">)</span>

    <span class="c1"># process items recursively (requests and folders)</span>
    <span class="k">if</span> <span class="s1">'item'</span> <span class="ow">in</span> <span class="n">collection</span><span class="p">:</span>
        <span class="n">process_items</span><span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="s1">'item'</span><span class="p">],</span> <span class="n">hash_tree3</span><span class="p">)</span>

    <span class="c1"># convert to XML string with pretty formatting</span>
    <span class="n">xml_str</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">jmeter_test_plan</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">'xml'</span><span class="p">)</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">xml_str</span><span class="p">)</span>

    <span class="c1"># empty elements are properly serialized</span>
    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">dom</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">'stringProp'</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">firstChild</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'HTTPSampler.port'</span><span class="p">:</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="s1">''</span><span class="p">))</span>

    <span class="n">pretty_xml</span> <span class="o">=</span> <span class="n">dom</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="s2">"    "</span><span class="p">)</span>

    <span class="c1"># remove redundant newlines and spaces added by minidom</span>
    <span class="n">pretty_xml</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pretty_xml</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pretty_xml</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add_user_defined_variables</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">parent_hash_tree</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"User Defined Variables"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Adds User Defined Variables to the JMeter JMX structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        variables (list): A list of dictionaries, where each dictionary represents a variable</span>
<span class="sd">                        with 'key' and 'value' (e.g., from Postman collection or environment).</span>
<span class="sd">        parent_hash_tree (ET.Element): The parent hashTree element to which the Arguments element will be added.</span>
<span class="sd">        name (str): The name to be displayed for this set of User Defined Variables in JMeter.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">variables</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">arguments</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent_hash_tree</span><span class="p">,</span> <span class="s1">'Arguments'</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'ArgumentsPanel'</span><span class="p">,</span>
        <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
        <span class="s1">'testname'</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
    <span class="p">})</span>
    <span class="n">collection_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="s1">'collectionProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Arguments.arguments"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
        <span class="c1"># ensure 'key' and 'value' exist before processing</span>
        <span class="k">if</span> <span class="s1">'key'</span> <span class="ow">in</span> <span class="n">var</span> <span class="ow">and</span> <span class="s1">'value'</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
            <span class="n">element_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">collection_prop</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'name'</span><span class="p">:</span> <span class="n">var</span><span class="p">[</span><span class="s1">'key'</span><span class="p">],</span>
                <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'Argument'</span>
            <span class="p">})</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.name"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="s1">'key'</span><span class="p">]</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.value"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="s1">'value'</span><span class="p">])</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.metadata"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'='</span>

    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent_hash_tree</span><span class="p">,</span> <span class="s1">'hashTree'</span><span class="p">)</span> <span class="c1"># This hashTree closes the Arguments element</span>

<span class="k">def</span> <span class="nf">process_items</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">parent_element</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Recursively processes Postman collection items (folders and requests).</span>

<span class="sd">    Args:</span>
<span class="sd">        items (list): A list of Postman collection items.</span>
<span class="sd">        parent_element (ET.Element): The parent XML element to which new elements will be added.</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">'item'</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="c1"># this is a dir, create a JMeter test fragment or just process its children directly</span>
            <span class="n">process_items</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">'item'</span><span class="p">],</span> <span class="n">parent_element</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># request</span>
            <span class="n">process_request</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">parent_element</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">parent_element</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Processes a single Postman request and converts it into an HTTPSamplerProxy element.</span>

<span class="sd">    Args:</span>
<span class="sd">        item (dict): The Postman request item dictionary.</span>
<span class="sd">        parent_element (ET.Element): The parent XML element to which the sampler and its hashTree will be added.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="s1">'request'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">request</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">'request'</span><span class="p">]</span>

    <span class="c1"># init URL and method components with defaults</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'method'</span><span class="p">,</span> <span class="s1">'GET'</span><span class="p">)</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="n">protocol</span> <span class="o">=</span> <span class="s1">'http'</span>
    <span class="n">port</span> <span class="o">=</span> <span class="s1">''</span>

    <span class="c1"># create HTTPSamplerProxy</span>
    <span class="n">sampler</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent_element</span><span class="p">,</span> <span class="s1">'HTTPSamplerProxy'</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'HttpTestSampleGui'</span><span class="p">,</span>
        <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'HTTPSamplerProxy'</span><span class="p">,</span>
        <span class="s1">'testname'</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'Unnamed Request'</span><span class="p">),</span>
        <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
    <span class="p">})</span>

    <span class="c1"># process request body</span>
    <span class="k">if</span> <span class="s1">'body'</span> <span class="ow">in</span> <span class="n">request</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">'body'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'mode'</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'raw'</span> <span class="ow">and</span> <span class="s1">'raw'</span> <span class="ow">in</span> <span class="n">body</span> <span class="ow">and</span> <span class="n">body</span><span class="p">[</span><span class="s1">'raw'</span><span class="p">]:</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.postBodyRaw"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'true'</span>
            <span class="n">element_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'HTTPsampler.Arguments'</span><span class="p">,</span>
                <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
                <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'HTTPArgumentsPanel'</span><span class="p">,</span>
                <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
                <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
            <span class="p">})</span>
            <span class="n">collection_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'collectionProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Arguments.arguments"</span><span class="p">)</span>

            <span class="n">arg_element</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">collection_prop</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'name'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span> <span class="c1"># name is empty for raw body</span>
                <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'HTTPArgument'</span>
            <span class="p">})</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPArgument.always_encode"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'false'</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.value"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">body</span><span class="p">[</span><span class="s1">'raw'</span><span class="p">]</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.metadata"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'='</span>
        <span class="k">elif</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'mode'</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'urlencoded'</span> <span class="ow">and</span> <span class="s1">'urlencoded'</span> <span class="ow">in</span> <span class="n">body</span> <span class="ow">and</span> <span class="n">body</span><span class="p">[</span><span class="s1">'urlencoded'</span><span class="p">]:</span>
            <span class="c1"># for x-www-form-urlencoded, JMeter handles params as args</span>
            <span class="n">element_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'HTTPsampler.Arguments'</span><span class="p">,</span>
                <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
                <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'HTTPArgumentsPanel'</span><span class="p">,</span>
                <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
                <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
            <span class="p">})</span>
            <span class="n">collection_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'collectionProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Arguments.arguments"</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">body</span><span class="p">[</span><span class="s1">'urlencoded'</span><span class="p">]:</span>
                <span class="n">arg_element</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">collection_prop</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="s1">'name'</span><span class="p">:</span> <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
                    <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'HTTPArgument'</span>
                <span class="p">})</span>
                <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPArgument.always_encode"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'false'</span>
                <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.value"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
                <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.metadata"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'='</span>
                <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPArgument.use_equals"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'true'</span>
                <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.name"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># handle other body types or empty body</span>
            <span class="n">element_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'HTTPsampler.Arguments'</span><span class="p">,</span>
                <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
                <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'HTTPArgumentsPanel'</span><span class="p">,</span>
                <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
                <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
            <span class="p">})</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'collectionProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Arguments.arguments"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># no body in request</span>
        <span class="n">element_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'HTTPsampler.Arguments'</span><span class="p">,</span>
            <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
            <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'HTTPArgumentsPanel'</span><span class="p">,</span>
            <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
            <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
        <span class="p">})</span>
        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'collectionProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Arguments.arguments"</span><span class="p">)</span>


    <span class="c1"># set common sampler props (bool props)</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.auto_redirects"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'false'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.follow_redirects"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'true'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.use_keepalive"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'true'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.monitor"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'false'</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.DO_MULTIPART_POST"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'false'</span> <span class="c1"># may need adjustment for multipart/form-data</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.embedded_url_re"</span><span class="p">)</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.contentEncoding"</span><span class="p">)</span>


    <span class="c1"># process URL (logic to determine domain, path, protocol, port)</span>
    <span class="k">if</span> <span class="s1">'url'</span> <span class="ow">in</span> <span class="n">request</span><span class="p">:</span>
        <span class="n">url_data</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">url_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url_data</span><span class="p">)</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">hostname</span> <span class="ow">or</span> <span class="s1">''</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span> <span class="ow">or</span> <span class="s1">''</span>
            <span class="n">protocol</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="s1">'http'</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">port</span><span class="p">)</span> <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">port</span> <span class="k">else</span> <span class="s1">''</span> <span class="c1"># Ensure port is string, even if None</span>

            <span class="c1"># handle query paramsfrom URL string</span>
            <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">query</span><span class="p">:</span>
                <span class="n">query_args_element_prop</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"./elementProp[@name='HTTPsampler.Arguments']"</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query_args_element_prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># Create if not already present from body</span>
                    <span class="n">query_args_element_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
                        <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'HTTPsampler.Arguments'</span><span class="p">,</span>
                        <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
                        <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'HTTPArgumentsPanel'</span><span class="p">,</span>
                        <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
                        <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
                    <span class="p">})</span>
                    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">query_args_element_prop</span><span class="p">,</span> <span class="s1">'collectionProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Arguments.arguments"</span><span class="p">)</span>

                <span class="n">query_collection_prop</span> <span class="o">=</span> <span class="n">query_args_element_prop</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"collectionProp[@name='Arguments.arguments']"</span><span class="p">)</span>

                <span class="n">query_params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">query_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                        <span class="n">arg_element</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">query_collection_prop</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
                            <span class="s1">'name'</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
                            <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'HTTPArgument'</span>
                        <span class="p">})</span>
                        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPArgument.always_encode"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'true'</span>
                        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.value"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.metadata"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'='</span>
                        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPArgument.use_equals"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'true'</span>
                        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.name"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">key</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">url_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Postman URL object structure</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="s1">'.'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'host'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'localhost'</span><span class="p">]))</span>
            <span class="n">path_parts</span> <span class="o">=</span> <span class="n">url_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'path'</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_parts</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">path</span> <span class="o">=</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="s1">'/'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_parts</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># assume it's a string</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">path_parts</span>
            <span class="n">protocol</span> <span class="o">=</span> <span class="n">url_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'protocol'</span><span class="p">,</span> <span class="s1">'http'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">protocol</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">':'</span><span class="p">):</span> <span class="c1"># Remove trailing colon if present</span>
                <span class="n">protocol</span> <span class="o">=</span> <span class="n">protocol</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">url_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'port'</span><span class="p">,</span> <span class="s1">''</span><span class="p">))</span> <span class="c1"># Ensure port is string, even if empty</span>

            <span class="c1"># process query params if present in URL object</span>
            <span class="k">if</span> <span class="s1">'query'</span> <span class="ow">in</span> <span class="n">url_data</span> <span class="ow">and</span> <span class="n">url_data</span><span class="p">[</span><span class="s1">'query'</span><span class="p">]:</span>
                <span class="n">args_element</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"./elementProp[@name='HTTPsampler.Arguments']/collectionProp[@name='Arguments.arguments']"</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">args_element</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">element_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
                        <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'HTTPsampler.Arguments'</span><span class="p">,</span>
                        <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
                        <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'HTTPArgumentsPanel'</span><span class="p">,</span>
                        <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'Arguments'</span><span class="p">,</span>
                        <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
                    <span class="p">})</span>
                    <span class="n">args_element</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'collectionProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Arguments.arguments"</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">url_data</span><span class="p">[</span><span class="s1">'query'</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s1">'key'</span> <span class="ow">in</span> <span class="n">param</span> <span class="ow">and</span> <span class="s1">'value'</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                        <span class="n">arg_element</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">args_element</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
                            <span class="s1">'name'</span><span class="p">:</span> <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
                            <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'HTTPArgument'</span>
                        <span class="p">})</span>
                        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPArgument.always_encode"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'true'</span>
                        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.value"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
                        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.metadata"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'='</span>
                        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'boolProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPArgument.use_equals"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'true'</span>
                        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">arg_element</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Argument.name"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

    <span class="c1"># create all primary sampler props using the extracted values</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.method"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">method</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.domain"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">domain</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.path"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">path</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.protocol"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">protocol</span>
    <span class="n">port_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HTTPSampler.port"</span><span class="p">)</span>
    <span class="n">port_prop</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">port</span> <span class="ow">or</span> <span class="s1">''</span>  <span class="c1"># This handles both None and empty string</span>


    <span class="c1"># create hashTree for sampler</span>
    <span class="n">sampler_hash_tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent_element</span><span class="p">,</span> <span class="s1">'hashTree'</span><span class="p">)</span>

    <span class="c1"># process headers</span>
    <span class="k">if</span> <span class="s1">'header'</span> <span class="ow">in</span> <span class="n">request</span> <span class="ow">and</span> <span class="n">request</span><span class="p">[</span><span class="s1">'header'</span><span class="p">]:</span>
        <span class="n">header_manager</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler_hash_tree</span><span class="p">,</span> <span class="s1">'HeaderManager'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'guiclass'</span><span class="p">:</span> <span class="s1">'HeaderPanel'</span><span class="p">,</span>
            <span class="s1">'testclass'</span><span class="p">:</span> <span class="s1">'HeaderManager'</span><span class="p">,</span>
            <span class="s1">'testname'</span><span class="p">:</span> <span class="s1">'HTTP Header Manager'</span><span class="p">,</span>
            <span class="s1">'enabled'</span><span class="p">:</span> <span class="s1">'true'</span>
        <span class="p">})</span>
        <span class="n">collection_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header_manager</span><span class="p">,</span> <span class="s1">'collectionProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"HeaderManager.headers"</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">request</span><span class="p">[</span><span class="s1">'header'</span><span class="p">]:</span>
            <span class="n">element_prop</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">collection_prop</span><span class="p">,</span> <span class="s1">'elementProp'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">'name'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
                <span class="s1">'elementType'</span><span class="p">:</span> <span class="s1">'Header'</span>
            <span class="p">})</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Header.name"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">element_prop</span><span class="p">,</span> <span class="s1">'stringProp'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Header.value"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>

        <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sampler_hash_tree</span><span class="p">,</span> <span class="s1">'hashTree'</span><span class="p">)</span>

    <span class="c1"># process URL vars (path vars in Postman terminology)</span>
    <span class="k">if</span> <span class="s1">'url'</span> <span class="ow">in</span> <span class="n">request</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">'url'</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">'variable'</span> <span class="ow">in</span> <span class="n">request</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]</span> <span class="ow">and</span> <span class="n">request</span><span class="p">[</span><span class="s1">'url'</span><span class="p">][</span><span class="s1">'variable'</span><span class="p">]:</span>
        <span class="n">add_user_defined_variables</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">'url'</span><span class="p">][</span><span class="s1">'variable'</span><span class="p">],</span> <span class="n">sampler_hash_tree</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"URL Path Variables"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Main func to parse args and init the conversion</span>
<span class="sd">    """</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'Convert Postman collection to JMeter JMX'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'input'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'Postman collection JSON file'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'output'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'Output JMX file'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-e'</span><span class="p">,</span> <span class="s1">'--environment'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'Postman environment JSON file (optional)'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">convert_postman_to_jmx</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">environment</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Successfully converted </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">input</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
    <!-- <div class="aspect-w-16 aspect-h-9 mx-auto"></div> CSS placeholder -->
  </div>
  <footer class="flex flex-col mt-10 ">
    <ul class="flex flex-wrap">
        <li
          class="bg-zinc-200 hover:bg-zinc-300 dark:hover:bg-zinc-800 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 mb-2 mr-2 px-3 py-1.5 rounded-md transition ease-in active:-translate-y-1 active:scale-110 duration-75">
          <a href="http://127.0.0.1:8000/tag/jmeter.html">jmeter</a>
        </li>
        <li
          class="bg-zinc-200 hover:bg-zinc-300 dark:hover:bg-zinc-800 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 mb-2 mr-2 px-3 py-1.5 rounded-md transition ease-in active:-translate-y-1 active:scale-110 duration-75">
          <a href="http://127.0.0.1:8000/tag/postman.html">postman</a>
        </li>
        <li
          class="bg-zinc-200 hover:bg-zinc-300 dark:hover:bg-zinc-800 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 mb-2 mr-2 px-3 py-1.5 rounded-md transition ease-in active:-translate-y-1 active:scale-110 duration-75">
          <a href="http://127.0.0.1:8000/tag/python.html">python</a>
        </li>
    </ul>
    <div class="flex w-full my-2 bg-zinc-200 dark:bg-zinc-700 rounded-lg">
      <div class="w-1/2 rounded-l-lg"></div>
      <div class="w-1/2 hover:bg-zinc-300 dark:hover:bg-zinc-800 rounded-r-lg ">
        <a class="flex flex-col" href="http://127.0.0.1:8000/go-server-rest-api-test.html">
          <div class="text-right mx-4 py-2">
            <p class="text-zinc-600 dark:text-zinc-300 text-sm">NEXT PAGE »</p>
            <p class="text-right py-1 hover:underline">Building & Testing a REST API in Go using httpserver, httptest, testing & testify</p>
          </div>
        </a>
      </div>
    </div>
    <div class="flex bg-zinc-200 dark:bg-zinc-700 py-2 rounded-lg justify-center space-x-2 text-xs">
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="twitter" aria-label="share Features on twitter"
            href="https://twitter.com/intent/tweet/?text=Features&amp;url=http://127.0.0.1:8000/https://github.com/emkeyen/postman-to-jmx">
            <i class="fab fa-twitter fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="linkedin" aria-label="share Features on linkedin"
            href="https://www.linkedin.com/sharing/share-offsite/?url=http://127.0.0.1:8000/https://github.com/emkeyen/postman-to-jmx">
            <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="reddit" aria-label="share Features on reddit"
            href="https://reddit.com/submit?url=http://127.0.0.1:8000/https://github.com/emkeyen/postman-to-jmx">
            <i class="fab fa-reddit fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="facebook" aria-label="share Features on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http://127.0.0.1:8000/https://github.com/emkeyen/postman-to-jmx">
            <i class="fab fa-facebook fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="whatsapp" aria-label="share Features on whatsapp"
            href="https://api.whatsapp.com/send?text=Features - http://127.0.0.1:8000/https://github.com/emkeyen/postman-to-jmx">
            <i class="fab fa-whatsapp fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
      <ul>
        <li class="bg-gray-900 p-1 text-white rounded-md">
          <a target="_blank" rel="noopener noreferrer" title="telegram" aria-label="share Features on telegram"
            href="https://telegram.me/share/url?text=Features&amp;url=http://127.0.0.1:8000/https://github.com/emkeyen/postman-to-jmx">
            <i class="fab fa-telegram fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
    </div>
  </footer>
  <div>
  </div>
</main>

    </div>
    <footer class="flex w-full text-xs justify-center mt-10 mb-6 text-zinc-600 dark:text-zinc-400">
        <div class="px-4">
            <span>©2025&nbsp;&#8226;&nbsp;</span>Powered by
            <a class="underline" href="https://github.com/getpelican/pelican">Pelican</a> in Python
        </div>
    </footer>


    <script>
        let themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        let themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia(
                '(prefers-color-scheme: dark)').matches)) {
            themeToggleLightIcon.classList.remove('hidden');
        } else {
            themeToggleDarkIcon.classList.remove('hidden');
        }
        let themeToggleBtn = document.getElementById('theme-toggle');
        themeToggleBtn.addEventListener('click', function () {
            themeToggleDarkIcon.classList.toggle('hidden');
            themeToggleLightIcon.classList.toggle('hidden');
            if (localStorage.getItem('color-theme')) {
                if (localStorage.getItem('color-theme') === 'light') {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                }
            } else {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                }
            }
        });
    </script>
</body>

</html>